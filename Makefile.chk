
# vim: ft=make noexpandtab

CHECK_C_FILES := \
   check/maugchck.c \
   check/chkmdat.c \
   check/chkmfmt.c \
   check/chkmlsp.c \
   check/chkmfil.c \
   check/chkmser.c

CFLAGS_CHECK := \
	-Wall \
	-Isrc \
	-Iapi/mem/unix \
	-Iapi/file/unix \
	-Iapi/log/unix \
	-Iapi/serial/asn1 \
	-DMAUG_NO_RETRO \
	-DDEBUG \
	-DDEBUG_LOG \
	-DDEBUG_THRESHOLD=1 \
	-DRETROFLAT_OS_UNIX

#CFLAGS_CHECK += -DMLISP_DUMP_ENABLED
#CFLAGS_CHECK += -DMFILE_TRACE_LVL=1
#CFLAGS_CHECK += -DMLISP_EXEC_TRACE_LVL=1
#CFLAGS_CHECK += -DMDATA_TRACE_LVL=1

#-DMFMT_TRACE_BMP_LVL=1
#-DMFMT_TRACE_RLE_LVL=1

mcheck: $(addprefix obj/,$(subst .c,.o,$(CHECK_C_FILES)))
	$(CC) -o $@ $^ $(shell pkg-config --libs check)

obj/%.o: %.c
	mkdir -p $(dir $@)
	$(CC) -c -o $@ $(CFLAGS_CHECK) $(shell pkg-config --cflags check) $<

clean:
	rm -rf mcheck obj

